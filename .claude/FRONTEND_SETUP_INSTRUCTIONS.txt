================================================================================
INSTRUCTIONS FOR CREATING A TYPESCRIPT FRONTEND FOR TWITCHMIXER
================================================================================

CONTEXT:
--------
This is a Kotlin Spring Boot backend application with:
- JWT-based authentication
- Twitch OAuth2 login integration
- REST API endpoints at http://localhost:8080
- CORS configured for http://localhost:3000

The backend is FULLY WORKING and has been tested with jwt-test.html.

CURRENT BACKEND STATE:
----------------------
âœ… Running on: http://localhost:8080
âœ… Authentication: JWT tokens (stored in localStorage)
âœ… OAuth Flow: Twitch OAuth2
âœ… Protected Endpoints: /api/users/me, /api/auth/token
âœ… Public Endpoints: /oauth2/authorization/twitch

BACKEND CONFIGURATION (from application.properties):
----------------------------------------------------
- Frontend URL: http://localhost:3000
- JWT expiration: 24 hours
- CORS origins: http://localhost:3000
- OAuth redirect after login: http://localhost:3000

API ENDPOINTS TO INTEGRATE:
---------------------------
1. GET /api/users/me
   - Requires: Authorization: Bearer {token}
   - Returns: { accountId, username, email, profileImageUrl }

2. GET /api/auth/token
   - Requires: Authorization: Bearer {token}
   - Returns: { token, expiresAt }

3. GET /oauth2/authorization/twitch
   - Starts OAuth flow
   - Redirects to Twitch, then back to frontend

AUTHENTICATION FLOW:
--------------------
1. User clicks "Login with Twitch" button
2. Frontend redirects to: http://localhost:8080/oauth2/authorization/twitch
3. User authorizes on Twitch
4. Backend redirects to: http://localhost:3000?token={jwt_token}
5. Frontend extracts token from URL query param
6. Frontend stores token in localStorage
7. Frontend uses token in Authorization header for API calls

OAUTH CALLBACK HANDLING:
------------------------
The backend OAuth2AuthenticationSuccessHandler redirects to:
http://localhost:3000?token={jwt_token}

Frontend MUST:
- Check URL for "?token=" parameter on load
- Extract and save to localStorage
- Remove token from URL (for security)
- Redirect to dashboard/home page

TOKEN STORAGE & USAGE:
----------------------
localStorage.setItem('jwt_token', token)
localStorage.getItem('jwt_token')
localStorage.removeItem('jwt_token')

All API calls must include:
headers: {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
}

================================================================================
STEP-BY-STEP FRONTEND SETUP INSTRUCTIONS
================================================================================

STEP 1: CREATE NEXT.JS + TYPESCRIPT PROJECT
--------------------------------------------
Navigate to parent directory (NOT inside the Spring Boot project):
$ cd C:\Users\reija\Documents\dev\twitchmixer

Create new Next.js TypeScript project:
$ npx create-next-app@latest twitchmixer-frontend

When prompted, choose these options:
- Would you like to use TypeScript? â†’ Yes
- Would you like to use ESLint? â†’ Yes
- Would you like to use Tailwind CSS? â†’ Yes (optional, but recommended)
- Would you like to use `src/` directory? â†’ Yes
- Would you like to use App Router? â†’ Yes
- Would you like to customize the default import alias? â†’ No

Enter the project:
$ cd twitchmixer-frontend

No additional packages needed - Next.js includes routing built-in!


STEP 2: PROJECT STRUCTURE TO CREATE
------------------------------------
Create these files and folders:

twitchmixer-frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx              (Login page - default route)
â”‚   â”‚   â”œâ”€â”€ layout.tsx            (Root layout - already exists)
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚       â””â”€â”€ page.tsx          (Dashboard page - protected)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ LoginButton.tsx       (Login button component)
â”‚   â”‚   â”œâ”€â”€ DashboardContent.tsx  (Dashboard UI component)
â”‚   â”‚   â””â”€â”€ AuthCallback.tsx      (Handles OAuth callback)
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ authService.ts        (Token management, login/logout)
â”‚   â”‚   â””â”€â”€ apiService.ts         (API calls with auth headers)
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ user.ts               (TypeScript interfaces)
â”‚   â””â”€â”€ middleware.ts             (Route protection middleware)


STEP 3: IMPLEMENT FILES
------------------------

FILE: src/types/user.ts
-----------------------
export interface User {
  accountId: number;
  username: string;
  email: string;
  profileImageUrl: string;
}

export interface AuthResponse {
  token: string;
  expiresAt: number;
}


FILE: src/services/authService.ts
----------------------------------
const TOKEN_KEY = 'jwt_token';
const API_BASE = 'http://localhost:8080';

export const authService = {
  getToken(): string | null {
    if (typeof window === 'undefined') return null; // Server-side check
    return localStorage.getItem(TOKEN_KEY);
  },

  setToken(token: string): void {
    if (typeof window === 'undefined') return;
    localStorage.setItem(TOKEN_KEY, token);
  },

  removeToken(): void {
    if (typeof window === 'undefined') return;
    localStorage.removeItem(TOKEN_KEY);
  },

  isAuthenticated(): boolean {
    return !!this.getToken();
  },

  login(): void {
    window.location.href = `${API_BASE}/oauth2/authorization/twitch`;
  },

  logout(): void {
    this.removeToken();
    window.location.href = '/';
  }
};


FILE: src/services/apiService.ts
---------------------------------
import { authService } from './authService';
import { User, AuthResponse } from '../types/user';

const API_BASE = 'http://localhost:8080/api';

async function fetchWithAuth(url: string, options: RequestInit = {}) {
  const token = authService.getToken();

  const headers = {
    'Content-Type': 'application/json',
    ...(token && { 'Authorization': `Bearer ${token}` }),
    ...options.headers,
  };

  const response = await fetch(url, { ...options, headers });

  if (response.status === 401) {
    authService.removeToken();
    if (typeof window !== 'undefined') {
      window.location.href = '/';
    }
    throw new Error('Unauthorized');
  }

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }

  return response.json();
}

export const apiService = {
  async getCurrentUser(): Promise<User> {
    return fetchWithAuth(`${API_BASE}/users/me`);
  },

  async refreshToken(): Promise<AuthResponse> {
    return fetchWithAuth(`${API_BASE}/auth/token`);
  }
};


FILE: src/middleware.ts
------------------------
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  const token = request.cookies.get('jwt_token')?.value ||
                request.nextUrl.searchParams.get('token');

  const isLoginPage = request.nextUrl.pathname === '/';
  const isDashboard = request.nextUrl.pathname.startsWith('/dashboard');

  // If accessing dashboard without token, redirect to login
  if (isDashboard && !token) {
    return NextResponse.redirect(new URL('/', request.url));
  }

  // If accessing login page with token, redirect to dashboard
  if (isLoginPage && token) {
    return NextResponse.redirect(new URL('/dashboard', request.url));
  }

  return NextResponse.next();
}

export const config = {
  matcher: ['/', '/dashboard/:path*'],
};


FILE: src/components/AuthCallback.tsx
--------------------------------------
'use client';

import { useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { authService } from '../services/authService';

export default function AuthCallback() {
  const router = useRouter();
  const searchParams = useSearchParams();

  useEffect(() => {
    const token = searchParams.get('token');

    if (token) {
      authService.setToken(token);
      // Clean URL and redirect to dashboard
      router.replace('/dashboard');
    } else if (authService.isAuthenticated()) {
      router.replace('/dashboard');
    }
  }, [searchParams, router]);

  return null;
}


FILE: src/components/LoginButton.tsx
-------------------------------------
'use client';

import { authService } from '../services/authService';

export default function LoginButton() {
  const handleLogin = () => {
    authService.login();
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen gap-5">
      <h1 className="text-4xl font-bold">ðŸŽ® TwitchMixer</h1>
      <p className="text-lg">Login with your Twitch account to continue</p>
      <button
        onClick={handleLogin}
        className="px-6 py-3 text-white bg-purple-600 rounded hover:bg-purple-700 transition"
      >
        Login with Twitch
      </button>
    </div>
  );
}


FILE: src/components/DashboardContent.tsx
------------------------------------------
'use client';

import { useEffect, useState } from 'react';
import { apiService } from '../services/apiService';
import { authService } from '../services/authService';
import { User } from '../types/user';

export default function DashboardContent() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadUserData();
  }, []);

  const loadUserData = async () => {
    try {
      setLoading(true);
      setError(null);
      const userData = await apiService.getCurrentUser();
      setUser(userData);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to load user data');
    } finally {
      setLoading(false);
    }
  };

  const handleLogout = () => {
    authService.logout();
  };

  if (loading) {
    return <div className="p-5">Loading...</div>;
  }

  if (error) {
    return (
      <div className="p-5 text-red-600">
        Error: {error}
        <button
          onClick={loadUserData}
          className="ml-2 px-3 py-1 bg-blue-500 text-white rounded"
        >
          Retry
        </button>
      </div>
    );
  }

  return (
    <div className="p-5">
      <h1 className="text-3xl font-bold">ðŸŽ® Dashboard</h1>

      {user && (
        <div className="mt-5">
          <h2 className="text-2xl">Welcome, {user.username}!</h2>

          <div className="mt-5">
            {user.profileImageUrl && (
              <img
                src={user.profileImageUrl}
                alt="Profile"
                className="w-24 h-24 rounded-full"
              />
            )}
          </div>

          <div className="mt-5 space-y-2">
            <p><strong>Account ID:</strong> {user.accountId}</p>
            <p><strong>Email:</strong> {user.email}</p>
            <p><strong>Username:</strong> {user.username}</p>
          </div>

          <div className="mt-8 flex gap-3">
            <button
              onClick={loadUserData}
              className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              ðŸ”„ Refresh Data
            </button>
            <button
              onClick={handleLogout}
              className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
            >
              ðŸšª Logout
            </button>
          </div>
        </div>
      )}
    </div>
  );
}


FILE: src/app/page.tsx (REPLACE EVERYTHING)
--------------------------------------------
import { Suspense } from 'react';
import LoginButton from '../components/LoginButton';
import AuthCallback from '../components/AuthCallback';

export default function Home() {
  return (
    <main>
      <Suspense fallback={<div>Loading...</div>}>
        <AuthCallback />
      </Suspense>
      <LoginButton />
    </main>
  );
}


FILE: src/app/dashboard/page.tsx
---------------------------------
import DashboardContent from '../../components/DashboardContent';

export default function DashboardPage() {
  return <DashboardContent />;
}


FILE: src/app/layout.tsx (UPDATE if needed)
--------------------------------------------
import type { Metadata } from 'next';
import './globals.css';

export const metadata: Metadata = {
  title: 'TwitchMixer',
  description: 'Twitch OAuth Integration',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  );
}


STEP 4: CONFIGURE NEXT.JS (Optional but recommended)
----------------------------------------------------
Create or update next.config.js in the root of twitchmixer-frontend/:

/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    domains: ['static-cdn.jtvnw.net'], // Twitch CDN for profile images
  },
};

module.exports = nextConfig;


STEP 5: RUN THE FRONTEND
-------------------------
Make sure backend is running on http://localhost:8080

In the frontend directory:
$ npm run dev

Frontend should start on: http://localhost:3000


STEP 6: TEST THE FLOW
----------------------
1. Open browser to http://localhost:3000
2. You should see the login page
3. Click "Login with Twitch"
4. You'll be redirected to Twitch OAuth
5. After authorizing, you'll come back to http://localhost:3000?token=...
6. The app should automatically:
   - Extract the token
   - Save it to localStorage
   - Redirect to /dashboard
   - Show your user info
7. Try "Refresh Data" button - should call /api/users/me
8. Try "Logout" - should clear token and return to login


TROUBLESHOOTING:
----------------
Problem: CORS errors
Solution: Make sure backend is running and CORS is configured for http://localhost:3000

Problem: 401 Unauthorized
Solution: Check that token is being sent in Authorization header

Problem: OAuth redirect doesn't work
Solution: Verify backend application.properties has app.frontend.url=http://localhost:3000

Problem: Token not extracted from URL
Solution: Check browser console, verify ?token= is in URL after OAuth callback

Problem: Frontend won't start on port 3000
Solution: Check if port is in use, or update backend CORS config to match different port

Problem: "Hydration error" in Next.js
Solution: This happens when localStorage is accessed during SSR. Make sure all components
that use authService are marked with 'use client' directive at the top.

Problem: Middleware not working
Solution: Ensure middleware.ts is in the src/ directory and config matcher is correct


IMPORTANT NOTES:
----------------
- Backend MUST be running on http://localhost:8080
- Frontend MUST run on http://localhost:3000 (or update backend CORS config)
- Tokens expire after 24 hours
- All protected API calls require Authorization header
- OAuth callback brings token as URL query parameter
- Store token in localStorage, not cookies or sessionStorage
- Next.js App Router uses file-based routing (no react-router-dom needed)
- All interactive components MUST have 'use client' directive
- Server components cannot access localStorage or window


NEXT.JS SPECIFIC NOTES:
-----------------------
- 'use client' directive is required for components using hooks (useState, useEffect, etc.)
- Server components run on the server and cannot access browser APIs
- Middleware runs on Edge runtime, before page renders
- Use next/navigation instead of react-router-dom (useRouter, useSearchParams, etc.)
- Tailwind CSS classes are used in examples (requires Tailwind to be installed)
- If you didn't install Tailwind, replace className attributes with style props


NEXT STEPS AFTER BASIC SETUP:
------------------------------
1. Add better error handling and loading states
2. Add automatic token refresh before expiration
3. Implement proper TypeScript strict mode
4. Add form validation for any future forms
5. Optimize images with next/image component
6. Add API error handling with retry logic
7. Implement proper error boundaries
8. Add environment variables for API URLs (.env.local)
9. Add unit tests with Jest and React Testing Library
10. Consider using React Query or SWR for data fetching


================================================================================
END OF INSTRUCTIONS
================================================================================

